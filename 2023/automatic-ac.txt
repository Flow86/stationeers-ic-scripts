# Automatic AC
# Chip for a AC Unit
# set d0 to the target pipe analyzer

# TODO: not finished, probably not needed at all?

define cTemperature 293 # K
define cHysteresis 2    # K

alias dAnalyzer d0
alias dAC db

alias rMode r0
alias rTemperature r1

init:
move rMode 0
jal update_state

start:
l rTemperature dAnalyzer Temperature
slt
bgtal r0Ratio cOnRatio turn_on
bltal r0Ratio cOnRatio turn_off

bdse dAlarm check_alarm

yield
j start

turn_on:
move rMode 1
s dAC Mode rMode
j ra

turn_off:
move rMode 0
j ra

check_alarm:
ls r1Slot1Occupied dFiltration 0 Occupied
ls r2Slot2Occupied dFiltration 1 Occupied

nor r3Alarm r1Slot1Occupied r2Slot2Occupied
s dAlarm On r3Alarm
j ra

update_state:
s dAC Mode rMode
j ra